function getCookie(e){var t=document.cookie;if(t.length>0){var o=t.indexOf(e+"=");if(-1!=o){o=o+e.length+1;var s=t.indexOf(";",o);return-1==s&&(s=t.length),unescape(t.substring(o,s))}}return""}function createXMLHttpRequest(){if(window.XMLHttpRequest)xhr=new XMLHttpRequest;else if(window.ActiveXObject)try{xhr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xhr=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}function uploadProgress(e){if(e.lengthComputable){var t=Math.round(99*e.loaded/e.total);document.getElementById("progressMain").style.display="block",document.getElementById("progressBar").style.width=t.toString()+"%"}}function uploadComplete(e){document.getElementById("progressBar").style.width="100%",document.getElementById("progressMain").style.display="none"}function uploadFailed(e){alert("There was an error attempting to upload the file.")}function uploadCanceled(e){alert("The upload has been canceled by the user or the browser dropped the connection.")}function uploadXlsFile(e,t){var o=new FormData;o.append("account",e),o.append("xls_file",t),createXMLHttpRequest(),xhr.open("POST","UploadXlsFile"),xhr.send(o),xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){var e=xhr.responseText;0==e?($("#xls_tips").html("导入成功"),$("#xls_tips").css("color","green")):1==e?($("#xls_tips").html("名单已存在"),$("#xls_tips").css("color","red")):($("#xls_tips").html("有误,请重试"),$("#xls_tips").css("color","red"))}}}function uploadFile(e,t,o,s,c,n){var a=$("#fileName").text().split(".")[1],i=new FormData;i.append("student_id",e),i.append("student_name",t),i.append("clazz",o),i.append("course_name",s),i.append("exp_num",c),i.append("fileType",a),i.append("file",document.getElementById("file").files[0]),createXMLHttpRequest(),xhr.upload.addEventListener("progress",uploadProgress,!1),xhr.addEventListener("load",uploadComplete,!1),xhr.addEventListener("error",uploadFailed,!1),xhr.addEventListener("abort",uploadCanceled,!1),xhr.open("POST","UploadFile"),xhr.send(i),xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){var e=xhr.responseText;0==e?($("#tipsdiv").css("display","block"),$("#tips").css("color","lime"),$("#tips").html("提交成功")):1==e?($("#tipsdiv").css("display","block"),$("#tips").css("color","violet"),$("#tips").html("补交成功")):($("#tipsdiv").css("display","block"),$("#tips").html("网络出错，请重传"))}}}function updatePsw(e,t,o){$.ajax({url:"UpdatePsw",type:"POST",dataType:"text",data:{account:e,old_psw:t,new_psw:o},success:function(e){0==e?(document.cookie="password="+escape(o),$("#userModal").modal("hide")):1==e?($("#change_psw_div").css("display","block"),$("#change_psw").html("旧密码输入错误")):($("#change_psw_div").css("display","block"),$("#change_psw").html("网络故障请重试"))}})}function showTBodyData(e,t){$("#tbody").empty();for(var o=5*(t-1);5*t>o&&o<e.length;o++){var s=e[o],c="<tr>";c+='<td><input type="checkbox"></td>',c+="<td>"+s.course_name+"</td>",c+="<td>"+s.exp_num+"</td>",c+="<td>"+s.last_time+"</td>",c+='<td><button type="button" id="td_upload'+(o%5+1)+'" class="btn btn-xs"><span class="glyphicon glyphicon-upload"></span></button></td>',c+="</tr>",$("#tbody").append(c)}}function getOvertimeCourse3(){var e=getCookie("account");$.ajax({url:"GetOvertimeCourse3",type:"POST",dataType:"json",data:{account:e},success:function(e){var t=$("#page_num b").html();overtime_homework=e,showTBodyData(overtime_homework,t)}})}function getUnSubmitCourse3(){var e=getCookie("account");$.ajax({url:"GetUnsubmitCourse3",type:"POST",dataType:"json",data:{account:e},success:function(e){un_submit_homework=e;var t=$("#page_num b").html();showTBodyData(un_submit_homework,t),$("#student_panel_heading").html("未交作业")}})}function getClassHomework(){var e=getCookie("account");$.ajax({url:"GetClassHomework",type:"POST",dataType:"json",data:{account:e},success:function(e){var t=$("#page_num b").html();class_homework=e,showTBodyData(class_homework,t)}})}function getSubmitCourse3(){var e=getCookie("account");$.ajax({url:"GetSubmitCourse3",type:"POST",dataType:"json",data:{account:e},success:function(e){var t=$("#page_num b").html();submit_homework=e,showTBodyData(submit_homework,t)}})}function cicosShowTBodyData(e,t){$("#cicos_check_thead").empty();var o="<tr><th></th><th>文件名</th><th>下载</th></tr>";$("#cicos_check_thead").append(o),$("#cicos_check_tbody").empty();for(var s=10*(t-1);10*t>s&&s<e.length;s++){var c=e[s],n="<tr>";n+='<td><input type="checkbox"></td>',n+="<td>"+c+"</td>",n+='<td><button type="button" id="btn_down'+(s%10+1)+'" class="btn btn-xs"><span class="glyphicon glyphicon-download"></span></button></td>',n+="</tr>",$("#cicos_check_tbody").append(n)}}function cicosShowTBodyUnsubmitStudent(e,t){$("#cicos_check_thead").empty();var o="<tr><th></th><th>学号</th><th>姓名</th><th>通知</th></tr>";$("#cicos_check_thead").append(o),$("#cicos_check_tbody").empty();for(var s=10*(t-1);10*t>s&&s<e.length;s++){var c=e[s],n="<tr>";n+='<td><input type="checkbox"></td>',n+="<td>"+c.student_id+"</td>",n+="<td>"+c.student_name+"</td>",n+='<td><button type="button" id="btn_down'+(s%10+1)+'" class="btn btn-xs"><span class="glyphicon glyphicon-envelope"></span></button></td>',n+="</tr>",$("#cicos_check_tbody").append(n)}}function cicosAddCourse(e,t,o,s){$.ajax({url:"CicosAddCourse",type:"POST",dataType:"text",data:{account:e,issue_course_name:t,issue_exp_num:o,issue_last_time:s},success:function(e){0==e?($("#sure_add_tips_div").css("display","block"),$("#sure_add_tips").html("添加成功"),$("#sure_add_tips").css("color","green")):($("#sure_add_tips_div").css("display","block"),$("#sure_add_tips").html("添加失败，请重试"),$("#sure_add_tips").css("color","red"))}})}function cicosDownAllSubmitHomework(e,t,o){$.ajax({url:"CicosDownAllSubmitHomework",type:"POST",data:{account:e,course:t,exp:o},success:function(e){console.log("data recieve"),console.log(e),window.location.href="http://victorlee.cn/back_up_file/"+e}})}function cicosGetOvertimeHomework(e,t,o){$.ajax({url:"CicosGetOvertimeHomework",type:"POST",dataType:"json",data:{account:e,course:t,exp:o},success:function(e){var t=$("#cicos_page_num b").html();cicos_overtime_homework=e,cicosShowTBodyData(cicos_overtime_homework,t)}})}function cicosGetUnsubmitHomework(e,t,o){$.ajax({url:"CicosGetUnsubmitHomework",type:"POST",dataType:"json",data:{account:e,course:t,exp:o},success:function(e){var t=$("#cicos_page_num b").html();cicos_un_submit_homework=e,cicosShowTBodyUnsubmitStudent(cicos_un_submit_homework,t)}})}function cicosGetSubmitHomework(e,t,o){$.ajax({url:"CicosGetSubmitHomework",type:"POST",dataType:"json",data:{account:e,course:t,exp:o},success:function(e){var t=$("#cicos_page_num b").html();cicos_submit_homework=e,cicosShowTBodyData(cicos_submit_homework,t)}})}function cicosLoadExp(e,t){$("#check_exp").empty(),$.ajax({url:"CicosLoadExp",type:"POST",dataType:"json",data:{account:e,course:t},success:function(o){for(var s=0;s<o.length;s++){var c=o[s];$("#check_exp").append("<option value='"+c+"'>"+c+"</option>")}var c=$("#check_exp option:selected").text();cicosGetSubmitHomework(e,t,c)}})}function cicosLoadCourse(e){$("#check_course").empty(),$.ajax({url:"CicosLoadCourse",type:"POST",dataType:"json",data:{account:e},success:function(t){for(var o=0;o<t.length;o++){var s=t[o];$("#check_course").append("<option value='"+s+"'>"+s+"</option>")}var s=$("#check_course option:selected").text();cicosLoadExp(e,s)}})}function checkUser(e,t){$.ajax({url:"CheckUser",async:!0,type:"POST",dataType:"text",data:{account:e,password:t},success:function(o){o>=0&&3>=o&&(document.cookie="account="+escape(e),document.cookie="password="+escape(t),$("#signinModal").modal("hide"),$("#signin").css("display","none"),$("#signup").css("display","none"),$("#locate").css("display","none"),$("#main").css("display","none"),$("#logout").css("display","inline-block"),$("#user").css("display","inline-block"),$("#user_account").html(e)),0==o||1==o||(2==o?(document.cookie="type="+escape("cicos"),$("#afterCicosLogin").css("display","block"),cicosLoadCourse(e),$("#div_check_homework").css("display","block"),$("#div_issue_homework").css("display","none"),$("#div_add_student").css("display","none"),$("#afterStudentLogin").css("display","none")):3==o?(document.cookie="type="+escape("student"),$("#afterStudentLogin").css("display","block"),getUnSubmitCourse3(),$("#afterCicosLogin").css("display","none")):4==o?($("#check_psw_div").css("display","block"),$("#check_psw").html("此账号尚未注册")):($("#check_psw_div").css("display","block"),$("#check_psw").html("账号密码不匹配")))}})}function checkStudent(e,t){$.ajax({url:"CheckStudent",type:"POST",dataType:"text",data:{student_id:e,student_name:t},success:function(o){if(0==o){var s=getCookie("clazz"),c=$("#course option:selected").text(),n=$("#exp option:selected").text(),a=document.getElementById("file").files[0];uploadFile(e,t,s,c,n,a)}else $("#tipsdiv").css("display","block"),$("#tips").html("学号姓名不匹配")}})}function loadLastTime(e,t,o,s){$.ajax({url:"GetLastTime",type:"POST",dataType:"text",data:{university:e,clazz:t,course_name:o,exp_num:s},success:function(e){}})}function loadExp(e,t,o){$("#exp").empty(),$.ajax({url:"LoadExpNum",type:"POST",dataType:"json",data:{university:e,clazz:t,course_name:o},success:function(e){for(var t=0;t<e.length;t++){var o=e[t];$("#exp").append("<option value='"+o+"'>"+o+"</option>")}}})}function loadCourse(e,t){$("#course").empty(),$.ajax({url:"LoadCourseName",type:"POST",dataType:"json",data:{university:e,clazz:t},success:function(e){for(var t=0;t<e.length;t++){var o=e[t];$("#course").append("<option value='"+o+"'>"+o+"</option>")}var s=getCookie("university"),c=getCookie("clazz"),o=$("#course option:selected").text();loadExp(s,c,o)}})}function loadClazz(e,t){$("#clazz").empty(),$.ajax({url:"LoadClazz",type:"POST",dataType:"json",data:{university:e,department:t},success:function(e){for(var t=0;t<e.length;t++){var o=e[t];$("#clazz").append("<option value='"+o+"'>"+o+"</option>")}if(document.cookie.length>0){var s=getCookie("university"),c=getCookie("clazz");loadCourse(s,c)}else{var n=$("#university option:selected").text(),o=$("#clazz option:selected").text();loadCourse(n,o)}}})}function loadDepartment(e){$("#department").empty(),$.ajax({url:"LoadDepartment",type:"POST",dataType:"json",data:{university:e},success:function(e){for(var t=0;t<e.length;t++){var o=e[t];$("#department").append("<option value='"+o+"'>"+o+"</option>")}var s=$("#university option:selected").text(),o=$("#department option:selected").text();loadClazz(s,o)}})}function loadUniversity(){$("#university").empty(),$("#department").empty(),$("#clazz").empty(),$.ajax({url:"LoadUniversity",type:"POST",dataType:"json",success:function(e){for(var t=0;t<e.length;t++){var o=e[t];$("#university").append("<option value='"+o+"'>"+o+"</option>")}var o=$("#university option:selected").text();loadDepartment(o)}})}function sortByTime(e){e.sort(function(e,t){return-1==sort_click?e.last_time>t.last_time:e.last_time<t.last_time})}var class_homework,submit_homework,un_submit_homework,overtime_homework,cicos_submit_homework,cicos_un_submit_homework,cicos_overtime_homework;$(function(){var e=document.cookie;if(e.length<=0)$("#locateModal").modal({backdrop:"static",keyboard:!1}),$("#closeLocate").hide();else{var t=getCookie("account"),o=getCookie("password");if(""!=t&&""!=o){$("#signin").css("display","none"),$("#signup").css("display","none"),$("#locate").css("display","none"),$("#main").css("display","none"),$("#logout").css("display","inline-block"),$("#user").css("display","inline-block"),$("#user_account").html(t);var s=getCookie("type");"student"==s?($("#afterStudentLogin").css("display","block"),getUnSubmitCourse3(),$("#afterCicosLogin").css("display","none")):"cicos"==s&&(cicosLoadCourse(t),$("#afterCicosLogin").css("display","block"),$("#afterStudentLogin").css("display","none"))}else{var c=getCookie("clazz");$("#location").html(c)}}}),$(document).ready(function(){var e=getCookie("type");""==e&&loadUniversity(),$("#logout").click(function(){loadUniversity(),document.cookie="account=",document.cookie="password=",document.cookie="type=",class_homework=null,submit_homework=null,un_submit_homework=null,overtime_homework=null,cicos_submit_homework=null,cicos_un_submit_homework=null,cicos_overtime_homework=null,$("#signin").css("display","inline-block"),$("#signup").css("display","inline-block"),$("#locate").css("display","inline-block"),$("#main").css("display","block");var e=getCookie("clazz");$("#location").html(e),$("#logout").css("display","none"),$("#user").css("display","none"),$("#afterStudentLogin").css("display","none"),$("#afterCicosLogin").css("display","none")}),$("#file").on("change",function(){$("#fileName").html(this.value.split("\\").pop()),$("#tipsdiv").css("display","none")}),$("#university").change(function(){var e=$("#university option:selected").text();loadDepartment(e)}),$("#department").change(function(){var e=$("#university option:selected").text(),t=$("#department option:selected").text();loadClazz(e,t)}),$("#course").change(function(){var e=getCookie("university"),t=getCookie("clazz"),o=$("#course option:selected").text();loadExp(e,t,o)}),$("#btnLocate").click(function(){var e=$("#university option:selected").text(),t=$("#department option:selected").text(),o=$("#clazz option:selected").text();if("university"==e||"department"==t||"class"==o)return!1;var s=new Date;s.setDate(s.getDate()+365),document.cookie="expires="+s.toGMTString(),document.cookie="university="+escape(e),document.cookie="department="+escape(t),document.cookie="clazz="+escape(o),$("#location").html(o),loadCourse(e,o)}),$("#btn_upload").click(function(){if("上传文件名"==$("#fileName").html()||""==$("#fileName").html())return $("#tipsdiv").css("display","block"),$("#tips").html("请选择上传文件"),!1;if($("#file").get(0).files[0].size>10485760)return $("#tipsdiv").css("display","block"),$("#tips").html("请选择小于10M的单个文件"),!1;var e=$("#fileName").text().split(".")[0],t=e.split("-")[0],o=e.split("-")[1];checkStudent(t,o)}),$("#btnRegister").click(function(){return!1}),$("#user").click(function(){$("#change_psw_div").css("display","none")}),$("#signin").click(function(){$("#check_psw_div").css("display","none")}),$("#btnLogin").click(function(){var e=$("#signin_account").val(),t=$("#signin_psw").val();return""!=e&&""!=t?(checkUser(e,t),!1):!1}),$("#btnChangePsw").click(function(){var e=getCookie("account"),t=$("#old_psw").val(),o=$("#new_psw").val(),s=$("#new_psw2").val();return""!=t&&""!=o&&""!=s?s!=o?($("#change_psw_div").css("display","block"),$("#change_psw").html("新的密码不一致"),!1):(updatePsw(e,t,o),!1):!1}),$("#student_all_check").attr("disabled",!0),$("#student_check_download").attr("disabled",!0),$("#btn_unsubmit_homework").click(function(){if($("#page_num b").html("1"),null!=un_submit_homework){var e=$("#page_num b").html();showTBodyData(un_submit_homework,e)}else getUnSubmitCourse3();$("#student_panel_heading").html("未交作业")}),$("#btn_class_homework").click(function(){if($("#page_num b").html("1"),null!=class_homework){var e=$("#page_num b").html();showTBodyData(class_homework,e)}else getClassHomework();$("#student_panel_heading").html("班级作业")}),$("#btn_overtime_homework").click(function(){if($("#page_num b").html("1"),null!=overtime_homework){var e=$("#page_num b").html();showTBodyData(overtime_homework,e)}else getOvertimeCourse3();$("#student_panel_heading").html("超期作业")}),$("#btn_submited_homework").click(function(){if($("#page_num b").html("1"),null!=submit_homework){var e=$("#page_num b").html();showTBodyData(submit_homework,e)}else getSubmitCourse3();$("#student_panel_heading").html("已交作业")}),$("#next_page").click(function(){var e=$("#tbody tr").length;if(5>e)return!1;var t=parseInt($("#page_num b").html())+1,o=$("#student_panel_heading").html();switch(o){case"未交作业":if(5*(t-2)+e==un_submit_homework.length)return!1;showTBodyData(un_submit_homework,t),$("#page_num b").html(t);break;case"班级作业":if(5*(t-2)+e==class_homework.length)return!1;showTBodyData(class_homework,t),$("#page_num b").html(t);break;case"超期作业":if(5*(t-2)+e==overtime_homework.length)return!1;showTBodyData(overtime_homework,t),$("#page_num b").html(t);break;case"已交作业":if(5*(t-2)+e==submit_homework.length)return!1;showTBodyData(submit_homework,t),$("#page_num b").html(t)}}),$("#previous_page").click(function(){var e=parseInt($("#page_num b").html())-1;if(1>e)return!1;var t=$("#student_panel_heading").html();switch(t){case"未交作业":showTBodyData(un_submit_homework,e),$("#page_num b").html(e);break;case"班级作业":showTBodyData(class_homework,e),$("#page_num b").html(e);break;case"超期作业":showTBodyData(overtime_homework,e),$("#page_num b").html(e);break;case"已交作业":showTBodyData(submit_homework,e),$("#page_num b").html(e)}}),$("#btn_overtime").click(function(){sort_click*=-1,$("#page_num b").html("1");var e=$("#student_panel_heading").html(),t=1;switch(e){case"未交作业":sortByTime(un_submit_homework),showTBodyData(un_submit_homework,t);break;case"班级作业":sortByTime(class_homework),showTBodyData(class_homework,t);break;case"超期作业":sortByTime(overtime_homework),showTBodyData(overtime_homework,t);break;case"已交作业":sortByTime(submit_homework),showTBodyData(submit_homework,t)}}),$("#check_course").change(function(){var e=getCookie("account"),t=$("#check_course option:selected").text();cicosLoadExp(e,t),$("#check_status").val("0"),$("#cicos_page_num b").html("1"),$("#cicos_check_download").css("display","inline-block"),$("#cicos_send_all_email").css("display","none")}),$("#check_exp").change(function(){var e=getCookie("account"),t=$("#check_course option:selected").text(),o=$("#check_exp option:selected").text();cicosGetSubmitHomework(e,t,o),$("#check_status").val("0"),$("#cicos_page_num b").html("1"),$("#cicos_check_download").css("display","inline-block"),$("#cicos_send_all_email").css("display","none")}),$("#check_status").change(function(){var e=getCookie("account"),t=$("#check_course option:selected").text(),o=$("#check_exp option:selected").text(),s=$("#check_status option:selected").text();switch($("#cicos_page_num b").html("1"),s){case"已交":cicosGetSubmitHomework(e,t,o),$("#cicos_check_download").css("display","inline-block"),$("#cicos_send_all_email").css("display","none");break;case"未交":cicosGetUnsubmitHomework(e,t,o),$("#cicos_check_download").css("display","none"),$("#cicos_send_all_email").css("display","inline-block");break;case"补交":cicosGetOvertimeHomework(e,t,o),$("#cicos_check_download").css("display","inline-block"),$("#cicos_send_all_email").css("display","none")}}),$("#cicos_next_page").click(function(){var e=$("#cicos_check_tbody tr").length;if(10>e)return!1;var t=parseInt($("#cicos_page_num b").html())+1,o=$("#check_status option:selected").text();switch(o){case"已交":if(10*(t-2)+e==cicos_submit_homework.length)return!1;cicosShowTBodyData(cicos_submit_homework,t),$("#cicos_page_num b").html(t);break;case"未交":if(10*(t-2)+e==cicos_un_submit_homework.length)return!1;cicosShowTBodyUnsubmitStudent(cicos_un_submit_homework,t),$("#cicos_page_num b").html(t);break;case"补交":if(10*(t-2)+e==cicos_overtime_homework.length)return!1;cicosShowTBodyData(cicos_overtime_homework,t),$("#cicos_page_num b").html(t)}}),$("#cicos_previous_page").click(function(){var e=parseInt($("#cicos_page_num b").html())-1;if(1>e)return!1;var t=$("#check_status option:selected").text();switch(t){case"已交":cicosShowTBodyData(cicos_submit_homework,e),$("#cicos_page_num b").html(e);break;case"未交":cicosShowTBodyUnsubmitStudent(cicos_un_submit_homework,e),$("#cicos_page_num b").html(e);break;case"补交":cicosShowTBodyData(cicos_overtime_homework,e),$("#cicos_page_num b").html(e)}}),$("#cicos_check_download").click(function(){var e=getCookie("account"),t=$("#check_course option:selected").text(),o=$("#check_exp option:selected").text(),s=$("#check_status option:selected").text();switch(s){case"已交":cicosDownAllSubmitHomework(e,t,o)}}),$("#btn_check_homework").click(function(){var e=getCookie("account");$("#check_status").val("0"),$("#cicos_page_num b").html("1"),cicosLoadCourse(e),$("#div_check_homework").css("display","block"),$("#cicos_check_download").css("display","inline-block"),$("#cicos_send_all_email").css("display","none"),$("#div_issue_homework").css("display","none"),$("#div_add_student").css("display","none")}),$("#btn_issue_homework").click(function(){cicos_submit_homework=null,cicos_un_submit_homework=null,cicos_overtime_homework=null,$("#div_check_homework").css("display","none"),$("#div_add_student").css("display","none"),$("#div_issue_homework").css("display","block"),$("#sure_add_tips_div").css("display","none")}),$("#btn_add_student").click(function(){cicos_submit_homework=null,cicos_un_submit_homework=null,cicos_overtime_homework=null,$("#div_check_homework").css("display","none"),$("#div_issue_homework").css("display","none"),$("#xls_tips").html(""),$("#div_add_student").css("display","block")}),$(".date").datetimepicker({weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,showMeridian:1}),$("#sure_issue_course").click(function(){var e=$("#issue_course_name").val(),t=$("#issue_exp_num").val(),o=$("#issue_last_time").val(),s=parseInt(t);if(isNaN(s)||""==o||""==t||""==e)return!1;var c=getCookie("account");cicosAddCourse(c,e,t,o)}),$("#xls_upload").click(function(){var e=$("#xls_file").val();if(""==e)return!1;var t=getCookie("account"),o=document.getElementById("xls_file").files[0];uploadXlsFile(t,o)})});var sort_click=1;